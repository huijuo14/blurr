name: Android CI with Debug  
  
on:  
  push:  
    branches: [ main, master ]  
  pull_request:  
    branches: [ main, master ]  
  
jobs:  
  build:  
    runs-on: ubuntu-latest  
    timeout-minutes: 60  
      
    steps:  
    - uses: actions/checkout@v4  
      
    - name: Set up JDK 17  
      uses: actions/setup-java@v3  
      with:  
        java-version: '17'  
        distribution: 'temurin'  
      
    - name: Setup Android SDK  
      uses: android-actions/setup-android@v2  
      
    - name: Cache Gradle packages  
      uses: actions/cache@v3  
      with:  
        path: |  
          ~/.gradle/caches  
          ~/.gradle/wrapper  
        key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}  
        restore-keys: |  
          ${{ runner.os }}-gradle-  
      
    - name: Grant execute permission for gradlew  
      run: chmod +x gradlew  
      
    - name: Validate required secrets  
      run: |  
        echo "ðŸ” Validating required secrets..."  
          
        # Only check the two secrets you have  
        if [ -z "${{ secrets.GEMINI_API_KEYS }}" ]; then  
          echo "âŒ Missing secret: GEMINI_API_KEYS"  
          exit 1  
        else  
          echo "âœ… Found secret: GEMINI_API_KEYS"  
        fi  
          
        if [ -z "${{ secrets.PICOVOICE_ACCESS_KEY }}" ]; then  
          echo "âŒ Missing secret: PICOVOICE_ACCESS_KEY"  
          exit 1  
        else  
          echo "âœ… Found secret: PICOVOICE_ACCESS_KEY"  
        fi  
          
        echo "âœ… Critical secrets validated"  
      
    - name: Create local.properties with available keys  
      run: |  
        echo "ðŸ“ Creating local.properties..."  
        echo "sdk.dir=$ANDROID_HOME" > local.properties  
          
        # Add your two API keys  
        echo "GEMINI_API_KEYS=${{ secrets.GEMINI_API_KEYS }}" >> local.properties  
        echo "PICOVOICE_ACCESS_KEY=${{ secrets.PICOVOICE_ACCESS_KEY }}" >> local.properties  
          
        # Set empty strings for all other keys  
        echo "GOOGLE_TTS_API_KEY=" >> local.properties  
        echo "TAVILY_API=" >> local.properties  
        echo "MEM0_API=" >> local.properties  
        echo "GCLOUD_GATEWAY_URL=" >> local.properties  
        echo "GCLOUD_GATEWAY_PICOVOICE_KEY=" >> local.properties  
        echo "GCLOUD_PROXY_URL=" >> local.properties  
        echo "GCLOUD_PROXY_URL_KEY=" >> local.properties  
        echo "REVENUE_CAT_PUBLIC_URL=" >> local.properties  
        echo "REVENUECAT_API_KEY=" >> local.properties  
          
        echo "âœ… local.properties created with your keys"  
      
    - name: Build with Gradle  
      run: |  
        echo "ðŸš€ Starting build process..."  
        ./gradlew assembleDebug --info --stacktrace  
      env:  
        GRADLE_OPTS: -Dorg.gradle.daemon=false -Dorg.gradle.debug=true  
      
    - name: Upload APK  
      if: success()  
      uses: actions/upload-artifact@v4  
      with:  
        name: app-debug  
        path: app/build/outputs/apk/debug/app-debug.apk  
        retention-days: 30
